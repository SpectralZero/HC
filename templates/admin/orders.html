{% extends "admin/base.html" %}

{% block title %}Orders{% endblock %}

{% block content %}
<div class="admin-page-header">
    <div>
        <h1><i class="bi bi-receipt"></i> Orders</h1>
        <p class="text-muted">View and manage customer orders</p>
    </div>
</div>

<!-- Filter Bar -->
<div class="orders-filter">
    <div class="search-box">
        <i class="bi bi-search"></i>
        <input type="text" id="orderSearch" placeholder="Search by name, phone, type..." class="form-control">
    </div>
    <select id="orderTypeFilter" class="form-control filter-select">
        <option value="">All Types</option>
        <option value="travel">‚úàÔ∏è Travel</option>
        <option value="recovery">üíä Recovery</option>
        <option value="mom">üë∂ Mom</option>
        <option value="pilgrim">üïå Pilgrim</option>
    </select>
    <select id="orderStatusFilter" class="form-control filter-select">
        <option value="">All Status</option>
        <option value="NEW">New</option>
        <option value="CONFIRMED">Confirmed</option>
        <option value="DELIVERED">Delivered</option>
    </select>
</div>

{% if orders %}
<div class="orders-summary">
    <span class="orders-count"><strong>{{ orders|length }}</strong> total orders</span>
</div>

<div class="orders-table-wrapper">
    <table class="orders-table" id="ordersTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Customer</th>
                <th>Phone</th>
                <th>Type</th>
                <th>Bag ID</th>
                <th>Notes</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr
                data-search="{{ order.name }} {{ order.phone }} {{ order.box_type }} {{ order.bag_id }} {{ order.status }}">
                <td><span class="order-date">{{ order.timestamp }}</span></td>
                <td><strong>{{ order.name }}</strong></td>
                <td><a href="tel:{{ order.phone }}" class="order-phone">{{ order.phone }}</a></td>
                <td><span class="type-badge type-{{ order.box_type|lower }}">{{ order.box_type }}</span></td>
                <td>{% if order.bag_id %}<code>{{ order.bag_id }}</code>{% else %}<span class="text-muted">-</span>{%
                    endif %}</td>
                <td class="order-notes">{{ order.notes if order.notes else '-' }}</td>
                <td>
                    <span class="order-status-badge status-{{ order.status|lower }}">{{ order.status }}</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <i class="bi bi-receipt" style="font-size:3rem"></i>
    <h3>No orders yet</h3>
    <p>Orders will appear here when customers submit through the order form.</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    (function () {
        const searchInput = document.getElementById('orderSearch');
        const typeFilter = document.getElementById('orderTypeFilter');
        const statusFilter = document.getElementById('orderStatusFilter');

        function filterOrders() {
            const query = searchInput.value.toLowerCase();
            const typeVal = typeFilter.value.toLowerCase();
            const statusVal = statusFilter.value.toLowerCase();

            document.querySelectorAll('#ordersTable tbody tr').forEach(function (row) {
                const text = row.getAttribute('data-search').toLowerCase();
                const matchesQuery = text.includes(query);
                const matchesType = !typeVal || text.includes(typeVal);
                const matchesStatus = !statusVal || text.includes(statusVal);
                row.style.display = (matchesQuery && matchesType && matchesStatus) ? '' : 'none';
            });
        }

        searchInput.addEventListener('input', filterOrders);
        typeFilter.addEventListener('change', filterOrders);
        statusFilter.addEventListener('change', filterOrders);
    })();
</script>
{% endblock %}